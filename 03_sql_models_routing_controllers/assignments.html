<!DOCTYPE html>
<html>
  <head>
    <title>SQL/ActiveRecord Assignment</title>
    <meta charset="utf-8" />

    <script src="js/remark-0.4.4.min.js"></script>
    <script src="js/jquery.min.js"></script>

    <script>
      remark.config({
        highlightStyle: "solarized_dark"
      });

      var hljs = remark.highlighter.engine();

      // extract the embedded styling from ansi spans
      remark.on('ready', function() {
        $('code.terminal > span.ansi').replaceWith(function(i, x) {
          return(x.replace(/&lt;(\/?(\w+).*?)&gt;/g, '<$1>'))
        });
      });
    </script>
    <script src="js/terminal.language.js"></script>
    <link rel="stylesheet" type="text/css" href="css/droid_serif.css" />
    <link rel="stylesheet" type="text/css" href="css/yanone_kaffeesatz.css" />
    <style type="text/css">
      body {
        font-family: 'Droid Serif';
        font-size: medium;
      }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: 400;
        margin-bottom: 0;
      }
      .small * {
        font-size: small !important;
      }
      code {
        border-radius: 5px;
      }
      .inverse {
        background: #272822;
        color: #777872;
        text-shadow: 0 0 20px #333;
      }
      .inverse h1, .inverse h2 {
        color: #f3f3f3;
        line-height: 0.8em;
      }
      .footnote {
        position: absolute;
        font-size: small;
        bottom: 3em;
        right: 3em;
      }
    </style>
  </head>
  <body><textarea id="source" readonly>

class: middle, center

# Assignments for SQL / Active Record

.footnote[
  created with [remark](http://github.com/gnab/remark)
]

---

class: middle

Use the rails migration generators to create migration that adds a column to products to hold the image url

---

class: middle

Replace the db/seeds.rb script with code that uses the ActiveRecord models to create 6 products, one for each image in the zip file. Come up with a reasonable name and price for each product, set the image URL to be in the format of "/images/products/<FILE_NAME>", so "/images/products/hat.jpg", for example. You can re-run the script with `rake db:setup`.

---

class: middle

Use the rails model generator to create models to allow Betastore to have categories and allow each product to be associated to multiple categories.

---

class: middle

Modify db/seeds.db to create categories and then put each product in one or more categories. Put at least one product in multiple categories.

---

class: middle

Use the rails model generator a model to hold information about a credit card. It should be associated to a customer, have a number and expiry_date

---

class: middle

Use the rails migration to modify the orders table so that each order has a credit card associated to it.

---

class: middle

Add the gem "faker" to your Gemfile. Run bundle to install the gem.

---

class: middle

Create a script that you can run with rails runner to generate 100 fake customers and a credit card for each customer. Make each customer place Place between 1 and 5 orders, with between 1 and 5 line items per order, with a quantity between 1 and 5 for each line item.

Hint: use `rand(4) + 1` to get a random between between 1 and 5.
Hint: use the `sample` method on an Array to get a random element of an Array

Extra Credit: Make sure the same product isn't used in multiple line items in the same order. Hint: use a combination of Array#delete_at and rand
Extra Credit: Use the "progressbar" gem to print out the progress of your script as it runs.

---

class: middle

Write an SQL query to get the total amount of money generated by all orders. Run it in a DB client such as psql, navicat, etc.

---

class: middle

Write a class method on order called `total_revenue` to execute the query from the previous SQL statement and return the result. Check that it works using the Rails console.

---

class: middle

Create data in the fixtures so that there are at least 3 orders. Write a test in `test/models/order_test.rb` so that you verify that `total_revenue` works correctly.

---

class: middle

Use ActiveRecord print out the name of the customer for each of the 5 most recent orders for the hat product.

---

class: middle

Use validations to make sure the following conditions are met before each of these objects can be saved:

Category - name exists
Customer - name exists, email exists and is unique
Product - name exists, price exists and is a number greater than 0
Order - customer_id exists, credit_card_id exists and the credit card belongs to the customer placing the order
Line Item -

To prove each of these, create a test that shows if the values exist that the record can be saved and that if the values are missing, there is an error

---

class: middle

Use an active record callback to send an email to the customer when an order is placed. The callback doesn't have to actually send an email, it is ok for now to just log a warn message that save "TODO: Send receipt for Order #{id} to #{customer.email}"

  </textarea><div id="slideshow"></div>
  </body>
</html>
